<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>現在の状態</title>
  <!-- React -->
  <script crossorigin src="https://unpkg.com/react@17/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@17/umd/react-dom.production.min.js"></script>
  <!-- Babel -->
  <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
  <!-- Framer Motion (UMD版) -->
  <script src="https://unpkg.com/framer-motion@4.1.17/dist/framer-motion.umd.js"></script>
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- lucide-react (UMD版) -->
  <script src="https://unpkg.com/lucide@latest/dist/umd/lucide-react.js"></script>
</head>
<body>
  <div id="root"></div>

  <!-- 以下、Babel で変換する JSX スクリプト -->
  <script type="text/babel">
    // React と Hooks を取得
    const { useState, useEffect } = React;
    // Framer Motion のモジュールは window.framerMotion 経由で取得
    const { motion, AnimatePresence } = window.framerMotion;
    // lucide-react の UMD版は window.lucideReact 経由で取得
    const { MapPin, Clock, RefreshCw } = window.lucideReact;

    function StatusPage() {
      const [status, setStatus] = useState("読み込み中...");
      const [lastUpdated, setLastUpdated] = useState("読み込み中...");
      const [isLoading, setIsLoading] = useState(false);

      // GitHub Pages 上の location.json からデータを取得
      const fetchStatus = async () => {
        setIsLoading(true);
        try {
          // キャッシュ対策としてクエリパラメータを付与
          const response = await fetch("location.json?nocache=" + Date.now());
          const data = await response.json();
          setStatus(data.status);
          setLastUpdated(data.last_updated);
        } catch (error) {
          setStatus("データを取得できませんでした");
          setLastUpdated("-");
        } finally {
          setIsLoading(false);
        }
      };

      // 初回ロード時に状態を取得
      useEffect(() => {
        fetchStatus();
      }, []);

      return (
        <div className="min-h-screen bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center p-4 overflow-hidden relative">
          <motion.div
            initial={{ opacity: 0, y: -50 }}
            animate={{ opacity: 1, y: 0 }}
            transition={{ duration: 0.5 }}
            className="bg-white rounded-lg shadow-xl p-8 max-w-md w-full relative z-10"
          >
            <h1 className="text-3xl font-bold text-center mb-6 text-gray-800">現在の状態</h1>
            <div className="space-y-4">
              <AnimatePresence mode="wait">
                <motion.div
                  key={status}
                  initial={{ opacity: 0, x: -50 }}
                  animate={{ opacity: 1, x: 0 }}
                  exit={{ opacity: 0, x: 50 }}
                  transition={{ duration: 0.3 }}
                  className="flex items-center space-x-3"
                >
                  <MapPin className="text-blue-500" />
                  <div>
                    <p className="text-sm text-gray-500">場所・状態</p>
                    <p className="text-lg font-semibold text-gray-800">{status}</p>
                  </div>
                </motion.div>
              </AnimatePresence>
              <div className="flex items-center space-x-3">
                <Clock className="text-blue-500" />
                <div>
                  <p className="text-sm text-gray-500">最終更新</p>
                  <p className="text-lg font-semibold text-gray-800">{lastUpdated}</p>
                </div>
              </div>
            </div>
            <motion.button
              whileHover={{ scale: 1.05 }}
              whileTap={{ scale: 0.95 }}
              onClick={fetchStatus}
              disabled={isLoading}
              className="mt-6 w-full bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-full transition duration-300 ease-in-out flex items-center justify-center"
            >
              {isLoading ? (
                <RefreshCw className="animate-spin" />
              ) : (
                <>
                  <RefreshCw className="mr-2" />
                  更新
                </>
              )}
            </motion.button>
          </motion.div>
        </div>
      );
    }

    ReactDOM.render(<StatusPage />, document.getElementById("root"));
  </script>
</body>
</html>
