<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>現在の状態</title>
  <!-- React -->
  <script crossorigin src="https://unpkg.com/react@17/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@17/umd/react-dom.production.min.js"></script>
  <!-- Babel -->
  <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
  <!-- Framer Motion (UMD版) -->
  <script src="https://unpkg.com/framer-motion@4.1.17/dist/framer-motion.umd.js"></script>
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
  <div id="root"></div>
  <script type="text/babel">
    const { useState, useEffect } = React;
    const { motion, AnimatePresence } = window.framerMotion;
    
    // インラインSVGでアイコンを定義
    function MapPinIcon() {
      return (
        <svg xmlns="http://www.w3.org/2000/svg" className="w-6 h-6 text-blue-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M12 11c1.657 0 3-1.343 3-3S13.657 5 12 5 9 6.343 9 8s1.343 3 3 3z" />
          <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M12 2c4.418 0 8 3.582 8 8 0 5.25-8 12-8 12S4 15.25 4 10c0-4.418 3.582-8 8-8z" />
        </svg>
      );
    }
    
    function ClockIcon() {
      return (
        <svg xmlns="http://www.w3.org/2000/svg" className="w-6 h-6 text-blue-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M12 6v6l4 2" />
          <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10z" />
        </svg>
      );
    }
    
    function RefreshIcon({ className = "" }) {
      return (
        <svg xmlns="http://www.w3.org/2000/svg" className={className + " w-6 h-6"} fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M4 4v5h.582M20 20v-5h-.581M4 15a8 8 0 018-8c1.657 0 3.18.505 4.434 1.366M20 9a8 8 0 00-8-8c-1.657 0-3.18.505-4.434 1.366" />
        </svg>
      );
    }
    
    function StatusPage() {
      const [status, setStatus] = useState("読み込み中...");
      const [lastUpdated, setLastUpdated] = useState("読み込み中...");
      const [isLoading, setIsLoading] = useState(false);
    
      // location.jsonから最新状態を取得
      const fetchStatus = async () => {
        setIsLoading(true);
        try {
          // キャッシュ対策としてクエリパラメータを付与
          const response = await fetch("location.json?nocache=" + Date.now());
          const data = await response.json();
          setStatus(data.status);
          setLastUpdated(data.last_updated);
        } catch (error) {
          setStatus("データを取得できませんでした");
          setLastUpdated("-");
        } finally {
          setIsLoading(false);
        }
      };
    
      useEffect(() => {
        fetchStatus();
      }, []);
    
      return (
        <div className="min-h-screen bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center p-4 overflow-hidden relative">
          <motion.div
            initial={{ opacity: 0, y: -50 }}
            animate={{ opacity: 1, y: 0 }}
            transition={{ duration: 0.5 }}
            className="bg-white rounded-lg shadow-xl p-8 max-w-md w-full relative z-10"
          >
            <h1 className="text-3xl font-bold text-center mb-6 text-gray-800">現在の状態</h1>
            <div className="space-y-4">
              <AnimatePresence mode="wait">
                <motion.div
                  key={status}
                  initial={{ opacity: 0, x: -50 }}
                  animate={{ opacity: 1, x: 0 }}
                  exit={{ opacity: 0, x: 50 }}
                  transition={{ duration: 0.3 }}
                  className="flex items-center space-x-3"
                >
                  <MapPinIcon />
                  <div>
                    <p className="text-sm text-gray-500">場所・状態</p>
                    <p className="text-lg font-semibold text-gray-800">{status}</p>
                  </div>
                </motion.div>
              </AnimatePresence>
              <div className="flex items-center space-x-3">
                <ClockIcon />
                <div>
                  <p className="text-sm text-gray-500">最終更新</p>
                  <p className="text-lg font-semibold text-gray-800">{lastUpdated}</p>
                </div>
              </div>
            </div>
            <motion.button
              whileHover={{ scale: 1.05 }}
              whileTap={{ scale: 0.95 }}
              onClick={fetchStatus}
              disabled={isLoading}
              className="mt-6 w-full bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-full transition duration-300 ease-in-out flex items-center justify-center"
            >
              {isLoading ? (
                <RefreshIcon className="animate-spin" />
              ) : (
                <>
                  <RefreshIcon className="mr-2" />
                  更新
                </>
              )}
            </motion.button>
          </motion.div>
        </div>
      );
    }
    
    ReactDOM.render(<StatusPage />, document.getElementById("root"));
  </script>
</body>
</html>
